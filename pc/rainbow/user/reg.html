<include file="public/header_regs" />
<div class="page messages">
    <div data-placeholder="messages">
    </div>
    <div data-bind="scope: 'messages'">
        <div data-bind="foreach: {data: cookieMessages, as: 'message' }" class="messages">
        </div>
        <div data-bind="foreach: {data: messages().messages, as: 'message' }" class="messages">
        </div>
    </div>
</div>
    <main id="maincontent" class="page-main"><a id="contentarea" tabindex="-1"></a>
    <div class="page-title-wrapper">
        <h1 class="page-title">
            <span class="base" data-ui-id="page-title-wrapper">成为我们的会员</span>
        </h1>
    </div>
    <div class="columns">
        <div class="column main">
            <input name="form_key" type="hidden" value="7JH9jxmdiqrzBwty">
            <div id="authenticationPopup" data-bind="scope:'authenticationPopup'" style="display: none;"></div>
                <form class="form create account form-create-account" action="" method="post" id="reg_form2" enctype="multipart/form-data" autocomplete="off" novalidate>
                    <div class="gg-block">
                        <fieldset class="fieldset create info">
                            <input type="hidden" name="success_url" value=""><input type="hidden" name="error_url" value="">
                            <div class="fields group">
                                <div class="field field-name-firstname required">
                                    <label class="label" for="firstname"><span>姓</span></label>
                                    <div class="control">
                                        <input type="text" id="firstname" name="firstname" value="" title="First Name" class="input-text required-entry"  autocomplete="off" aria-required="true" placeholder="请输入你的姓名" required="">
                                    </div>
                                </div>
                                <div class="field field-name-lastname required">
                                    <label class="label" for="lastname"><span>名字</span></label>
                                    <div class="control">
                                        <input type="text" id="lastname" name="lastname" value="" title="Last Name" class="input-text required-entry"  autocomplete="off" aria-required="true" placeholder="请输入你的名称" required="">
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                        <fieldset class="fieldset create account" data-hasrequired="* Required Fields">
                            <div class="field required">
                                <label for="email_address" class="label"><span>邮件</span></label>
                                <div class="control">
                                    <input type="email" name="email" placeholder="请输入邮箱" id="email_address" autocomplete="email" value="" title="Email" class="input-text">
                                </div>
                            </div>
                            <div class="fields group">
                                <div class="field password required">
                                    <label for="password" class="label"><span>密码</span></label>
                                    <div class="control">
                                        <input type="password" id="password" name="password" placeholder="6-16位大小写英文字母、数字或符号的组合" id="password" title="Password" class="input-text" maxlength="16" value="" required="" autocomplete="off" aria-required="true">
                                    </div>
                                </div>
                                <div class="field confirmation required">
                                    <label for="password-confirmation" class="label"><span>确认密码</span></label>
                                    <div class="control">
                                        <input type="password" name="password_confirmation" placeholder="请再次输入密码" maxlength="16" title="Confirm Password" id="password-confirmation" class="input-text" required="" value="">
                                    </div>
                                </div>
                            </div>
                            <div id="remember-me-box" class="field choice persistent">
                                <input type="checkbox" name="persistent_remember_me" class="checkbox" id="remember_meQzSdjskSbC" checked title="Remember Me"><label for="remember_meQzSdjskSbC" class="label"><span>记住我 这是什么？</span></label><span class="tooltip wrapper"><a class="link tooltip toggle" href="#">What's this?</a><span class="tooltip content">即使您未登录，也请选中“记住我”以访问此计算机上的购物车.</span></span>
                            </div>
                            <div class="field captcha required" role="user_create">
                                <label for="captcha_user_create" class="label"><span>请输入下面的验证码</span></label>
                                <div class="control captcha">
                                    <input name="captcha[user_create]" type="text" placeholder="图像验证码"  type="text" class="input-text required-entry" id="captcha_user_create" name="verify_code" required="" autocomplete="off" aria-required="true">
                                    <div class="nested">
                                        <div class="field captcha no-label" data-captcha="user_create" id="captcha-container-user_create">
                                            <div class="control captcha-image">
                                                <img width="180" alt="Please type the letters below" class="captcha-img" height="50" id="reflsh_code2" src="/index.php/Home/User/verify/type/user_reg.html">
                                                <button  onclick="verify('reflsh_code2')" type="button" class="action reload captcha-reload" title="Reload captcha">
                                                    <span>重新載入验证码</span>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="captcha-note note">
                                            <strong>注意</strong>: 验证码区分大小写。
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                        <button type="button" onClick="check_submit();" class="action register primary" title="Create an Account"><span>创建一个新账户</span></button>
                    </div>
                    <div class="block-login">
                        <p>
                            已经有一个帐户？&nbsp;&nbsp;&nbsp;
                            <a class="action back" href="#">登陆账户</a>
                        </p>
                    </div>
                </form>
            </div>
        </div>
    </main>
    <div class="page-bottom">
        <div class="content">
            <a class="back-to-top">
                <h4 class="text-uppercase">Back to top</h4>
            </a>
        </div>
    </div>

    <script>
        // 普通 图形验证码 
        function verify(id){
            $('#'+id).attr('src','/index.php?m=Home&c=User&a=verify&type=user_reg&r='+Math.random());
        }

         function check_submit(){
            $.ajax({
                type : "POST",
                url:"{:U('Home/User/reg')}",
                dataType: "json",
                data: $('#reg_form2').serialize(),
                success: function(data){
                    //console.log(data);
                    if(data.status == 1){
                        layer.msg(data.msg, {icon: 1},function(){
                            window.location.href = "{:U('Home/Index/index')}";
                        });
                    }else{
                        layer.alert(data.msg, {icon: 2},function(index){
                            $('.verifyImg').trigger('click');
                            layer.close(index);
                        });
                    }

                }
            });

        }

        function checkEmail(str){
            var reg = /^([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
            if(reg.test(str)){
                return true;
            }else{
                return false;
            }
        }
    </script>
    {:widget('Cates/footer')}